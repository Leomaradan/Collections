<div *ngIf="!item" class="loader">
    <img src="assets/ajax-loader-big.gif">
</div>
<div *ngIf="loading" class="loader-modal">
    <img src="assets/ajax-loader-big.gif">
</div>
<form *ngIf="item" #f="ngForm" novalidate>

    <ol *ngIf="item.id" class="breadcrumb">
      <li class="breadcrumb-item"><a [routerLink]="['../..']">{{ appTitre }}</a></li>
      <li class="breadcrumb-item"><a [routerLink]="['..']">{{ item.titre }}</a></li>
      <li class="breadcrumb-item active">Editer</li>
    </ol>  
    <ol *ngIf="!item.id" class="breadcrumb">
      <li class="breadcrumb-item"><a [routerLink]="['../..']">{{ appTitre }}</a></li>
      <li class="breadcrumb-item active">Ajouter</li>
    </ol>  
    
    <div *ngFor="let error of formErrors" class="alert alert-danger">
        {{ error }}
    </div>
    
    <!-- Titre -->
    <div class="form-section">
        <div class="form-group row">
            <label for="formTitre" class="col-sm-2 col-form-label">Titre</label>
            <div class="col-sm-10">
                <input type="text" name="titre" [(ngModel)]="item.titre" class="form-control form-control-sm" id="formTitre" placeholder="Dune, etc...">
            </div>
        </div>
    </div>
    
    <!-- Genre  -->
    <div class="form-section">
        <div class="form-group row">
            <label class="col-sm-2 col-form-label">Genre</label>
            <div class="col-sm-10">
                <ng2-completer name="genreDisplay" [(ngModel)]="genreDisplay" class="form-control" [dataService]="genreDataService" [minSearchLength]="0" [textNoResults]=""></ng2-completer>
            </div>
        </div>
    </div>    
    
    <!-- Série -->
    <div class="form-section" *ngIf="features.indexOf('serie') !== -1">
        <div class="form-group row">
            <label class="col-sm-2 col-form-label">Série</label>
            <div class="col-sm-10">
                <ng2-completer #serieSelect name="serieDisplay" 
                               class="form-control" 
                               [(ngModel)]="serieDisplay" 
                               [dataService]="serieDataService" 
                               [minSearchLength]="0" 
                               [textNoResults]=""
                               (change)="switchSerie(serieSelect.value)" 
                               (selected)="switchSerie(serieSelect.value)"></ng2-completer>
            </div>
        </div>
        <div class="form-group row" *ngIf="item.serie !== null">  
            <label for="formSerieNewVolumeMax" class="col-sm-2 col-form-label col-form-label-sm">Nombre de volume</label>
            <div class="col-sm-10">
                <input type="text" name="volume_max" class="form-control form-control-sm" id="formSerieNewVolumeMax" [(ngModel)]="item.serie.volume_max">
            </div>      
        </div>          
    </div>       
    
    <!-- Auteur -->  
    <div class="form-section">
        <div class="form-group row">
            <label class="col-sm-2 col-form-label">Auteur</label>
            <div class="col-sm-10">
                <p class="form-control-static mb-0" *ngFor="let auteur of item.auteurs">
                   <input type="hidden" value="{{auteur.id}}">
                    {{auteur.nom}}
                    <button class="btn btn-danger btn-right" (click)="removeAuteur(auteur.id, auteur.nom)"><span class="glyphicons glyphicons-minus-sign"></span></button>
                </p>
            </div>
        </div>
        <div class="form-group row">
            <label for="formSerieSelect" class="col-sm-2 col-form-label col-form-label-sm">Ajouter un auteur</label>
            <div class="col-sm-8">
                <ng2-completer #auteurNew class="form-control" [dataService]="auteurDataService" [minSearchLength]="0"></ng2-completer>
            </div> 
            <div class="col-sm-2"><button class="btn btn-success btn-right" (click)="addAuteurAutocomplete(auteurNew.value); auteurNew.value = '';"><span class="glyphicons glyphicons-plus-sign"></span></button></div>
        </div>
    </div>

    <!-- Volume -->    
    <div class="form-section" *ngIf="features.indexOf('volume') !== -1">
        <div class="form-group row">
            <label for="formVolume" class="col-sm-2 col-form-label col-form-label-sm">Volume</label>
            <div class="col-sm-10">
                <input type="number" name="volume" [(ngModel)]="item.volume" class="form-control form-control-sm" id="formVolume">
            </div>
        </div>
    </div>    
    
    <!-- Volume Possedes -->    
    <div class="form-section" *ngIf="features.indexOf('volume_possedes') !== -1">
        <div class="form-group row">
            <label for="formVolume" class="col-sm-2 col-form-label col-form-label-sm">Volume max</label>
            <div class="col-sm-10">
                <input type="number" name="volume_max" [(ngModel)]="item.volume_max" class="form-control form-control-sm" id="formVolume"
                       (change)="volumeMaxChanged()">
            </div>
        </div>
        
        <div class="form-group row">
            <label for="formVolume" class="col-sm-2 col-form-label col-form-label-sm">Volume(s) possedés</label>
            <div class="col-sm-10 form-check">               
                <label *ngFor="let volume of item.listVolumeMax" class="form-check-label-block">
                    <input type="checkbox" class="form-check-input"
                        [checked]="item.volumes.indexOf(volume) !== -1" 
                        (change)="$event.target.checked? (item.volumes.push(volume)) : ( item.volumes.splice(item.volumes.indexOf(volume) , 1))">    
                        {{volume}}
                </label>
            </div>
        </div>     
    </div>        
    
    <!-- Format -->    
    <div class="form-section" *ngIf="features.indexOf('format') !== -1">
        <div class="form-group row">
            <label for="formVolume" class="col-sm-2 col-form-label col-form-label-sm">Format</label>
            <div class="col-sm-10 form-check">               
                <label *ngFor="let format of item.listFormat" class="form-check-label">
                    <input type="checkbox" class="form-check-input"
                        [checked]="item.format.indexOf(format.value) !== -1" 
                        (change)="$event.target.checked? (item.format.push(format.value)) : ( item.format.splice(item.format.indexOf(format.value) , 1))">    
                        {{format.display}}
                </label>
            </div>
        </div>
    </div>

    <!-- Couverture -->    
    <div class="form-section">
        <div class="form-group row">
            <label for="formCouverture" class="col-sm-2 col-form-label col-form-label-sm">Couverture</label>
            <div class="col-sm-10">
                <input type="url" name="couverture" [(ngModel)]="item.couverture" class="form-control form-control-sm" id="formCouverture">
            </div>
        </div>
    </div>   

    <button type="submit" class="btn btn-primary" (click)="saveItem()">Sauver</button>
</form>